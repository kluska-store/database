CREATE EXTENSION IF NOT EXISTS "pgcrypto";

CREATE TABLE "store" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "cnpj" VARCHAR(14) UNIQUE NOT NULL,
  "name" VARCHAR(50) NOT NULL,
  "picture_url" VARCHAR(255),
  "email" VARCHAR(100) NOT NULL,
  "address_id" INTEGER UNIQUE NOT NULL
);

CREATE TABLE "store_phones" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "phone" VARCHAR(15) NOT NULL,
  "store_id" INTEGER UNIQUE NOT NULL
);

CREATE TABLE "address" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "country" VARCHAR(50) NOT NULL,
  "state" VARCHAR(50) NOT NULL,
  "city" VARCHAR(100) NOT NULL,
  "street" VARCHAR(100) NOT NULL,
  "number" INTEGER NOT NULL,
  "postal_code" VARCHAR(10) NOT NULL,
  "complement" VARCHAR(255)
);

CREATE TABLE "user" (
  "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  "cpf" VARCHAR(11) UNIQUE NOT NULL,
  "profile_pic_url" VARCHAR(255),
  "email" VARCHAR(50) NOT NULL,
  "username" VARCHAR(50) NOT NULL,
  "phone" VARCHAR(15) NOT NULL,
  "birthday" DATE NOT NULL,
  "is_active" BOOLEAN NOT NULL DEFAULT FALSE,
  "address_id" INTEGER UNIQUE NOT NULL
);

CREATE TABLE "session" (
  "token" VARCHAR(36) PRIMARY KEY,
  "expiration_date" TIMESTAMP NOT NULL,
  "user_id" uuid NOT NULL
);

CREATE TABLE "product" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "name" VARCHAR(100) NOT NULL,
  "price" numeric(10,2) NOT NULL,
  "attributes" JSONB,
  "store_id" INTEGER NOT NULL
);

CREATE TABLE "wish_list" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "name" VARCHAR(50) NOT NULL,
  "user_id" UUID NOT NULL
);

CREATE TABLE "wish_list_item" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "wish_list_id" INTEGER NOT NULL,
  "product_id" INTEGER NOT NULL
);

CREATE TABLE "cart" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "user_id" UUID UNIQUE NOT NULL
);

CREATE TABLE "cart_item" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "cart_it" INTEGER NOT NULL,
  "product_id" INTEGER NOT NULL
);

CREATE TABLE "payment" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "value" NUMERIC(10,2) NOT NULL,
  "date" TIMESTAMP NOT NULL,
  "payment_method_id" INTEGER NOT NULL,
  "user_id" UUID NOT NULL
);

CREATE TABLE "payment_method" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "method" VARCHAR(30) UNIQUE NOT NULL
);

CREATE TABLE "transference" (
  "id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "store_id" INTEGER NOT NULL,
  "payment_id" INTEGER NOT NULL,
  "value" NUMERIC(10,2) NOT NULL
);